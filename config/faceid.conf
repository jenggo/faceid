# FaceID Configuration

[camera]
device = /dev/video0
width = 640
height = 480

[recognition]
# Threshold for face matching (lower = more strict, higher = more lenient)
# SFace recommended: 0.3-0.5
# Glint recommended: 0.01-0.1
threshold = 0.4
# Timeout in seconds for authentication attempt
timeout = 5

[face_detection]
# Face detection confidence threshold (0.0-1.0, higher = stricter)
# Filters out low-confidence detections to reduce false positives
# Default: 0.31 (works well for most cases)
# For IR cameras or low-light: lower values (0.1-0.2) may work better
# For bright conditions: higher values (0.5-0.7) reduce false positives
#
# AUTOMATIC ADAPTATION: Uses 3-stage cascading detection
#   Stage 1: Standard CLAHE preprocessing + primary detector
#   Stage 2: Aggressive CLAHE (low-light/IR) + primary detector
#   Stage 3: Aggressive CLAHE + secondary fallback detector
# This automatically adapts to lighting conditions without manual tuning
confidence = 0.31
# Face tracking optimization: only run full detection every N frames
# Uses optical flow tracking for intermediate frames (much faster)
# Values: 0 = always detect (no tracking), 5-10 = recommended, 15+ = aggressive
# Recommended: 10 (gives ~84% speed improvement)
tracking_interval = 10

[logging]
# Log file location
log_file = /var/log/faceid.log
# Log level: DEBUG, INFO, WARNING, ERROR
log_level = INFO

[authentication]
# Enable parallel face + fingerprint authentication
# First method to succeed will authenticate the user
enable_fingerprint = true
# Enable performance optimizations (caching, image preprocessing)
enable_optimizations = true
# Check lid state before attempting biometric authentication
# Biometrics will be skipped if lid is closed (falls through to password)
check_lid_state = true
# Check display state before attempting biometric authentication
# Biometrics will be skipped if display is off/blanked (falls through to password)
# This prevents camera/fingerprint from waking the device when screen is off
check_display_state = true
# Skip biometric authentication when using external monitor only (laptop screen off)
# This is useful when laptop is docked - camera can't see your face properly
# When enabled, biometrics will only work when laptop's built-in display is on
skip_external_monitor_only = true

# Delay (in milliseconds) before starting biometric auth on lock screen
# This gives the screen time to turn off after pressing lock button (Meta+L)
# Recommended: 500-1500ms (1500ms = 1.5 seconds)
# Set to 0 to disable delay
lock_screen_delay_ms = 1000

# Delay (in milliseconds) before initializing fingerprint reader
# Since face detection is very fast (~27ms), delaying fingerprint saves battery
# Face auth gets a head start, fingerprint only activates if face fails quickly
# Recommended: 300-1000ms (gives face auth time to succeed first)
# Set to 0 to start both methods simultaneously (legacy behavior)
fingerprint_delay_ms = 500

# Number of frames to verify before authenticating
frame_count = 3

[security]
# Log authentication attempts
log_attempts = true

[ir_emitter]
# Enable IR emitter control
enabled = true

# Emitter device (usually same as camera)
device = /dev/video0

# Emitter control codes (device-specific)
# Leave empty for auto-detection
control_codes =

[presence_detection]
# Enable/disable presence detection service
enabled = true

# Time (in seconds) of inactivity before starting face scanning
# During active use (typing/mouse), NO scanning occurs (saves battery)
inactive_threshold_seconds = 15

# Interval (in seconds) between face scans when idle
scan_interval_seconds = 5

# Number of consecutive scan failures before confirming user is away
max_scan_failures = 2

# Maximum idle time (in minutes) before confirming user is away
# After this time, screen locks even if scans are inconclusive
max_idle_time_minutes = 15

# Mouse jitter filter threshold (in milliseconds)
# Input events faster than this are considered noise (desk bumps, etc.)
# Only movements separated by more than this threshold reset the idle timer
mouse_jitter_threshold_ms = 300

# Camera shutter detection thresholds
# Mean brightness below this value indicates closed shutter
shutter_brightness_threshold = 10.0

# Brightness standard deviation below this indicates uniform (closed) shutter
shutter_variance_threshold = 2.0

# Time (in minutes) to wait before locking if shutter is closed
# User may close shutter for privacy - don't immediately lock
# After this timeout, lock screen anyway for security
shutter_timeout_minutes = 5

[no_peek]
# Enable/disable "no peek" detection
# Detects additional faces (shoulder surfing) behind the user
# When enabled, screen will BLANK (but not lock) if extra face detected
enabled = true

# Minimum distance (in pixels) between detected faces to count as separate person
# This prevents false positives from same person's reflection or shifted position
# Typical face width is 100-150 pixels at arm's length
min_face_distance_pixels = 80

# Minimum face size (as percentage of screen width) to count as "peek threat"
# Faces smaller than this are too far away to read the screen clearly
# Recommended: 0.08 (8% of screen width) = ~2 meters distance
min_face_size_percent = 0.08

# Delay (in seconds) before blanking screen after detecting extra face
# This prevents accidental blanking when someone walks by
# Only if face stays for this duration will screen blank
peek_detection_delay_seconds = 2

# Grace period (in seconds) after extra face disappears before re-enabling screen
# This prevents screen flickering if person moves in/out of frame
unblank_delay_seconds = 3

[schedule]
# Enable/disable schedule-based presence detection
# When enabled, presence detection only runs during configured days/times
enabled = false

# Active days (comma-separated, 1=Monday, 7=Sunday)
# Examples:
#   1,2,3,4,5      = Monday through Friday (weekdays)
#   4              = Thursday only
#   1,3,5          = Monday, Wednesday, Friday
#   6,7            = Saturday, Sunday (weekends)
active_days = 1,2,3,4,5

# Active time range (24-hour format: HHMM)
# Examples:
#   0900-1700      = 9 AM to 5 PM
#   0800-1200      = 8 AM to 12 PM (noon)
#   1400-2200      = 2 PM to 10 PM
#   0000-2359      = All day
time_start = 0900
time_end = 1700
